<!DOCTYPE html>
<html>
<head>
  <title>Side Navbar Example</title>
  <style>
    /* CSS for Side Navbar */
    body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
    }

    .navbar {
      height: 100vh;
      width: 200px;
      position: fixed;
      top: 0;
      left: 0;
      background-color: #333;
      color: #fff;
    }

    .navbar ul {
      list-style-type: none;
      margin: 0;
      padding: 0;
    }

    .navbar li {
      padding: 10px;
      cursor: pointer;
    }

    .navbar li:hover {
      background-color: #111;
    }

    .content {
      margin-left: 200px;
      padding: 20px;
    }
    h1 {
      text-align: center;
    }

    form {
      /* max-width: 400px; */
      margin: 20px auto;
      padding: 20px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }

    label {
      display: block;
      margin-left: auto;
    }

    input[type="text"],
    textarea {
      width: 20%;
      padding: 5px;
      border: 1px solid #ccc;
      border-radius: 3px;
    }

    input[type="submit"],
    input[type="button"] {
      display: block;
      width: 10%;
      margin-left: auto;
      padding: 10px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 3px;
      cursor: pointer;
    }

    input[type="submit"]:hover,
    input[type="button"]:hover {
      background-color: #45a049;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
    .first-row{
      display: flex;
    }
    .second-row{
      display: flex;
    }
    .top{
      text-align: center;
    }
    table {
      border-collapse: collapse;
      width: 100%;
    }
    #searchInput {
      width: 100%;
      padding: 12px 20px;
      margin: 8px 0;
      box-sizing: border-box;
    }
    .modal {
      display: none;
      position: fixed;
      z-index: 1;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0, 0, 0, 0.4);
    }
    .modal-content {
      background-color: #fefefe;
      margin: 15% auto;
      padding: 20px;
      border: 1px solid #888;
      width: 40%;
    }
    #searchLocation {
      width: 100%;
      padding: 12px 20px;
      margin: 8px 0;
      box-sizing: border-box;
    }
  </style>
</head>
<body>
  <div class="navbar">
    <ul>
      <li onclick="showPage('police')">Add Police Officer</li>
      <li onclick="showPage('update')">Update Traffic Staff</li>
      <li onclick="showPage('addlocation')">Add Location</li>
      <li onclick="showPage('updatelocation')">Update Location</li>

    </ul>
  </div>

  <div class="content" id="content">
    <div class="page" id="police">
      <h1>Add Police Officers</h1>
      <form id="addForm" action="./add-officer.php" method="post">
        <h2 style="text-align: center;">Enter Staff Details</h2>
        <div class="top">
          <label for="staffName">Officer ID:</label>
          <input type="text" id="staffName" name="officerid" required>
        </div>
        <br/><br/>
        <div class="first-row">
          
          <label for="location">First Name:</label>
          <input type="text" id="location" name="ofirstname" required>
          
          <label for="staffName">Last Name:</label>
          <input type="text" id="staffName" name="olastname" required>
          
          <label for="location">Contact:</label>
          <input type="text" id="location" name="ocontact" required>
        </div>
        <br/><br/>
        <div class="second-row">
          <label for="staffName">Staff E-Mail:</label>
          <input type="text" id="staffName" name="oemail" required>
          
          <label for="location">Rank:</label>
          <input type="text" id="location" name="orank" required>
          
          <label for="staffName">Password:</label>
          <input type="text" id="staffName" name="password" required>
        </div>
        <br/><br/>
        <input type="submit" value="Add">
      </form>
    </div>

    <div class="page" id="update">
      <h1>Update Staff</h1>
      <input type="text" class="searchbar" id="searchInput" placeholder="Search by officer ID">
      <table id="officersTable">
        <thead>
          <tr>
            <th>id</th>
            <th>fname</th>
            <th>lname</th>
            <th>contact</th>
            <th>email</th>
            <th>rank</th>
            <th>password</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="officersTableBody"></tbody>
      </table>
    </div>

    <div class="page" id="addlocation">
      <h1>Add Location</h1>
      <form id="addForm" action="./add-location.php" method="post">
        <h2 style="text-align: center;">Enter Location Details</h2>
        <div class="first-row">
          
          <label for="locationid">Location ID:</label>
          <br/>
          <input type="text" id="locationid" name="locationid" required>
          
          <label for="locationname">Location Name:</label>
          <br/>
          <input type="text" id="locationname" name="locationname" required>
        </div>
        <br/><br/>
        <input type="submit" value="Add">
      </form>
    </div>

    <div class="page" id="updatelocation">
      <h1>Update Location</h1>
      <input type="text" class="searchbar" id="searchLocation" placeholder="Search by location ID">
      <table id="LocationTable">
        <thead>
          <tr>
            <th>Location id</th>
            <th>Location Name</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="locationTableBody"></tbody>
      </table>
    </div>
    
  </div>

  <div id="editModal" class="modal">
    <div class="modal-content">
      <h2>Edit Officer</h2>
      <form id="editForm" method="post" action="./officer-update-admin.php">
        <label for="editID">ID:</label>
        <input type="text" id="editID" name="editID" required><br>

        <label for="editFirstName">First Name:</label>
        <input type="text" id="editFirstName" name="editFirstName" required><br>

        <label for="editLastName">Last Name:</label>
        <input type="text" id="editLastName" name="editLastName" required><br>

        <label for="editContact">Contact:</label>
        <input type="text" id="editContact" name="editContact" required><br>

        <label for="editEmail">Email:</label>
        <input type="text" id="editEmail" name="editEmail" required><br>

        <label for="editRank">Rank:</label>
        <input type="text" id="editRank" name="editRank" required><br>

        <label for="editPassword">Password:</label>
        <input type="text" id="editPassword" name="editPassword" required><br>

        <button type="submit" id="updateButton">Update</button>
      </form>
      <button onclick="closeModal()">Cancel</button>
    </div>
  </div>

  <div id="editLocationModal" class="modal">
    <div class="modal-content">
      <h2>Edit Location</h2>
      <form id="editLocationForm" method="post" action="./location-update-admin.php">
        <label for="editID">ID:</label>
        <input type="text" id="editID" name="editID" required><br>

        <label for="editLocation">Location:</label>
        <input type="text" id="editLocation" name="editLocation" required><br>

        <button type="submit" id="updateButton">Update</button>
      </form>
      <button onclick="closeLocationModal()">Cancel</button>
    </div>
  </div>

  <script>
    function showPage(pageId) {
      var pages = document.getElementsByClassName("page");
      for (var i = 0; i < pages.length; i++) {
        pages[i].style.display = "none";
      }
      document.getElementById(pageId).style.display = "block";
    }

    // JavaScript code for filtering the officers in real-time
    const searchInput = document.getElementById('searchInput');
    const officersTable = document.getElementById('officersTableBody');

    searchInput.addEventListener('keyup', function() {
      const searchValue = searchInput.value.toLowerCase();
      const rows = officersTable.getElementsByTagName('tr');

      for (let i = 0; i < rows.length; i++) {
        const officerName = rows[i].getElementsByTagName('td')[0].innerText.toLowerCase();
        if (officerName.includes(searchValue)) {
          rows[i].style.display = '';
        } else {
          rows[i].style.display = 'none';
        }
      }
    });

    // JavaScript code for filtering the locations in real-time
    const searchLocation = document.getElementById('searchLocation');
    const LocationTable = document.getElementById('locationTableBody');

    searchLocation.addEventListener('keyup', function() {
      const searchValue = searchLocation.value.toLowerCase();
      const rows = LocationTable.getElementsByTagName('tr');

      for (let i = 0; i < rows.length; i++) {
        const officerName = rows[i].getElementsByTagName('td')[0].innerText.toLowerCase();
        if (officerName.includes(searchValue)) {
          rows[i].style.display = '';
        } else {
          rows[i].style.display = 'none';
        }
      }
    });

    // Fetch data from the MySQL database and populate the officer's table
    fetch('officers.php')
      .then(response => response.json())
      .then(officersData => {
        officersData.forEach(function(officer) {
          const row = officersTable.insertRow();
          row.insertCell().innerText = officer.id;
          row.insertCell().innerText = officer.fname;
          row.insertCell().innerText = officer.lname;
          row.insertCell().innerText = officer.contact;
          row.insertCell().innerText = officer.email;
          row.insertCell().innerText = officer.rank;
          row.insertCell().innerText = officer.pass;
          const actionsCell = row.insertCell();

          actionsCell.innerHTML = `
            <button class="edit-button" data-officer-id="${officer.id}" 
            onclick="openEditModal(${officer.id})">Edit</button>
            <button onclick="deleteOfficer(${officer.id})">Delete</button>
          `;

        });
      })
      .catch(error => {
        console.error('Error:', error);
      });
    
    // Fetch data from the MySQL database and populate the location's table
    fetch('locations.php')
      .then(response => response.json())
      .then(stationsData => {
        stationsData.forEach(function(location) {
          const row = LocationTable.insertRow();
          row.insertCell().innerText = location.id;
          row.insertCell().innerText = location.location;
          const actionsCell = row.insertCell();

          actionsCell.innerHTML = `
            <button class="edit-button" data-officer-id="${location.id}" 
            onclick="openEditLocationModal(${location.id})">Edit</button>
            <button onclick="deleteLocation(${location.id})">Delete</button>
          `;

        });
      })
      .catch(error => {
        console.error('Error:', error);
      });

// Function to handle opening the edit officer modal
function openEditModal(officerId) {
  const modal = document.getElementById('editModal');
  const editForm = document.getElementById('editForm');

  // Fetch officer data for the given ID
  fetch(`officers.php?id=${officerId}`)
    .then(response => response.json())
    .then(officerData => {
      const {
        fname,
        lname,
        contact,
        email,
        rank,
        pass
      } = officerData;


      // Set the values in the edit form
      editForm.elements.editID.value = officerData[officerId]["id"];
      editForm.elements.editFirstName.value = officerData[officerId]["fname"];
      editForm.elements.editLastName.value = officerData[officerId]["lname"];
      editForm.elements.editContact.value = officerData[officerId]["contact"];
      editForm.elements.editEmail.value = officerData[officerId]["email"];
      editForm.elements.editRank.value = officerData[officerId]["rank"];
      editForm.elements.editPassword.value = officerData[officerId]["pass"];

      // Show the modal
      modal.style.display = "block";
    })
    .catch(error => {
      console.error('Error:', error);
    });
}

// Function to handle opening the edit location modal
function openEditLocationModal(stationId) {
  const modal = document.getElementById('editLocationModal');
  const editForm = document.getElementById('editLocationForm');

  // Fetch location data for the given ID
  fetch(`locations.php?id=${stationId}`)
    .then(response => response.json())
    .then(stationData => {
      const {
        location
      } = stationData;


      // Set the values in the edit form
      editForm.elements.editID.value = stationData[stationId]["id"];
      editForm.elements.editLocation.value = stationData[stationId]["location"];

      // Show the modal
      modal.style.display = "block";
    })
    .catch(error => {
      console.error('Error:', error);
    });
}

document.addEventListener('DOMContentLoaded', function() {
  // Attach event listeners to the edit buttons
  const editButtons = document.querySelectorAll('.edit-button');
  editButtons.forEach(button => {
    button.addEventListener('click', function() {
      if (document.getElementById('update').style.display === 'block') {
        // Update page is active, open the edit officer modal
        const officerId = this.dataset.officerId;
        openEditModal(officerId);
      } else if (document.getElementById('updatelocation').style.display === 'block') {
        // Update Location page is active, open the edit location modal
        const locationId = this.dataset.locationId;
        openEditLocationModal(locationId);
      }
    });
  });
});


// Function to handle delete officer button click
function deleteOfficer(officerId) {
 if (confirm("Are you sure you want to delete this officer?")) {
    // Send a request to the server to delete the officer record
    fetch(`delete-officer.php?id=${officerId}`, {
      method: 'POST',
    })
      .then(response => {
        console.log(response);
        if (response.ok) {
          // If the delete operation was successful, remove the row from the table
          const row = document.querySelector(`tr[data-officer-id="${officerId}"]`);
          if (row) {
            row.remove();
          } else {
            console.error('Row not found.');
          }
          location.reload();
        } else {
          console.error('Failed to delete officer record.');
        }
      })
      .catch(error => {
        console.error('Error:', error);
      });
  }
}


// Function to handle delete station button click
function deleteLocation(stationId) {
 if (confirm("Are you sure you want to delete this station?")) {
    // Send a request to the server to delete the station record
    fetch(`delete-station.php?id=${stationId}`, {
      method: 'POST',
    })
      .then(response => {
        console.log(response);
        if (response.ok) {
          // If the delete operation was successful, remove the row from the table
          const row = document.querySelector(`tr[data-officer-id="${stationId}"]`);
          if (row) {
            row.remove();
          } else {
            console.error('Row not found.');
          }
          location.reload();
        } else {
          console.error('Failed to delete officer record.');
        }
      })
      .catch(error => {
        console.error('Error:', error);
      });
  }
}

    // Function to handle closing the edit officer modal
    function closeModal() {
      const modal = document.getElementById('editModal');
      const editForm = document.getElementById('editForm');

      // Clear the values in the edit form
      editForm.reset();

      // Hide the modal
      modal.style.display = "none";
    }

    // Function to handle closing the edit location modal
    function closeLocationModal() {
      const modal = document.getElementById('editLocationModal');
      const editForm = document.getElementById('editForm');

      // Clear the values in the edit form
      editForm.reset();

      // Hide the modal
      modal.style.display = "none";
    }
  </script>
</body>
</html>
